<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
  <style>
    #googleMapDiv{
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -999;
    }
    .modal-header{
      text-align: center;
    }
  </style>
</head>
<body>
<div id="googleMapDiv"></div>
<div class="row" style="background:transparent;">
  <form class="col s12">
    <div class="row">
      <img id="compass" src="https://cdn4.iconfinder.com/data/icons/iconsimple-freebies/512/compass_2.png" alt="" style="width:20vw;float:right;">
    </div>
  </form>
</div>
<div class="fixed-action-btn click-to-toggle" style="position:absolute;bottom:10px;right:10px;">
  <a class="btn-floating btn-large waves-effect waves-light red">
    <i class="material-icons">menu</i>
  </a>
  <ul>
    <li><a class="btn-floating modal-trigger" href="#contactUs"><i class="material-icons">supervisor_account</i></a></li>
    <li><a class="btn-floating red" id="centerLocationBut"><i class="material-icons">my_location</i></a></li>
    <li><a class="btn-floating yellow darken-1" id="navigationBut"><i class="material-icons">navigation</i></a></li>

    <% if(logined==true){ %>
    <li><a class="btn-floating modal-trigger green" href="#health"><i class="material-icons">perm_identity</i></a></li>
    <li><a class="btn-floating modal-trigger blue" href="#account"><i class="material-icons">settings</i></a></li>
    <%} else{%>
    <li><a class="btn-floating modal-trigger blue" href="#login"><i class="material-icons">vpn_key</i></a></li>
    <% } %>

  </ul>
</div>
<!-- Modal Structure -->
<div id="contactUs" class="modal yellow lighten-2">
  <div class="modal-content">
    <div class="modal-header">
      <h4>Contact Us</h4>
    </div>
    <%- include('./contact/contact.ejs',{master:master,contact:contact}); %>
  </div>
  <div class="modal-footer yellow darken-2">
    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
  </div>
</div>
<% if(logined==true){ %>
<!-- Modal Structure -->
<div id="health" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h4>Health Manager</h4>
    </div>
    <%- include('./health/health.ejs',{}); %>
  </div>
  <div class="modal-footer">
    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
  </div>
</div>
<!-- Modal Structure -->
<div id="account" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h4>Account</h4>
    </div>
    <%- include('./account/account.ejs',{}); %>
  </div>
  <div class="modal-footer">
    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
  </div>
</div>
<%} else{%>
<!-- Modal Structure -->
<div id="login" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h4>Login</h4>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <input id="accountInput" type="text" class="validate">
        <label for="Account">Account</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <input id="passwordInput" type="password" class="validate">
        <label for="password">Password</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <a class="waves-effect waves-light btn red" id="loginBut">Login</a>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Close</a>
  </div>
</div>
<% } %>
</body>
<script src="./js/map/googleMap.js"></script>
<script src="./js/socket/socket.js"></script>
<script>
  $(document).ready(function(){
    var navigationButToggle = false;
    var locationOriginToggle = false;
    var locationOriginInterval;
    $('.modal-trigger').leanModal();
    $('#centerLocationBut').click(myLocation);
    $('#navigationBut').click(getNearestBike);
    <% if(logined==false){ %>
    $('#loginBut').click(loginButHendler);
    function loginButHendler() {
      var acint = $('#accountInput').val();
      var psint = $('#passwordInput').val();
      if(acint!=""&&psint!=""){
        $.post('/login',{id:acint,password:psint},function() {
          window.location.replace('/');
        });
      }
    }
    <%}%>
    function myLocation() {
      if(locationOriginToggle){
        locationOriginToggle = false;
        map.unLockMove();
        clearInterval(locationOriginInterval);
        $('#centerLocationBut i').html("my_location");
      }
      else{
        locationOriginToggle = true;
        map.lockMove();
        map.setOriginLocation();
        locationOriginInterval = setInterval(function() {
          map.setOriginLocation();
        },1000);
        $('#centerLocationBut i').html("stop");
      }
    }
    function getNearestBike() {
      if(navigationButToggle){
        navigationButToggle = false;
        map.clearPath();
        $('#navigationBut i').html("navigation");
      }
      else{
        navigationButToggle = true;
        map.setNearestBikePath();
        $('#navigationBut i').html("stop");
      }
    }
    socket.run(map);
  });
</script>
</html>
